{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar LRU_1 = require(\"./utils/LRU\");\nvar CACHE_SIZE = 1000;\n/**\n * Inspired node-lru-cache[https://github.com/isaacs/node-lru-cache]\n */\nvar EndpointCache = /** @class */function () {\n  function EndpointCache(maxSize) {\n    if (maxSize === void 0) {\n      maxSize = CACHE_SIZE;\n    }\n    this.maxSize = maxSize;\n    this.cache = new LRU_1.LRUCache(maxSize);\n  }\n  ;\n  Object.defineProperty(EndpointCache.prototype, \"size\", {\n    get: function () {\n      return this.cache.length;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  EndpointCache.prototype.put = function (key, value) {\n    var keyString = typeof key !== 'string' ? EndpointCache.getKeyString(key) : key;\n    var endpointRecord = this.populateValue(value);\n    this.cache.put(keyString, endpointRecord);\n  };\n  EndpointCache.prototype.get = function (key) {\n    var keyString = typeof key !== 'string' ? EndpointCache.getKeyString(key) : key;\n    var now = Date.now();\n    var records = this.cache.get(keyString);\n    if (records) {\n      for (var i = records.length - 1; i >= 0; i--) {\n        var record = records[i];\n        if (record.Expire < now) {\n          records.splice(i, 1);\n        }\n      }\n      if (records.length === 0) {\n        this.cache.remove(keyString);\n        return undefined;\n      }\n    }\n    return records;\n  };\n  EndpointCache.getKeyString = function (key) {\n    var identifiers = [];\n    var identifierNames = Object.keys(key).sort();\n    for (var i = 0; i < identifierNames.length; i++) {\n      var identifierName = identifierNames[i];\n      if (key[identifierName] === undefined) continue;\n      identifiers.push(key[identifierName]);\n    }\n    return identifiers.join(' ');\n  };\n  EndpointCache.prototype.populateValue = function (endpoints) {\n    var now = Date.now();\n    return endpoints.map(function (endpoint) {\n      return {\n        Address: endpoint.Address || '',\n        Expire: now + (endpoint.CachePeriodInMinutes || 1) * 60 * 1000\n      };\n    });\n  };\n  EndpointCache.prototype.empty = function () {\n    this.cache.empty();\n  };\n  EndpointCache.prototype.remove = function (key) {\n    var keyString = typeof key !== 'string' ? EndpointCache.getKeyString(key) : key;\n    this.cache.remove(keyString);\n  };\n  return EndpointCache;\n}();\nexports.EndpointCache = EndpointCache;","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}